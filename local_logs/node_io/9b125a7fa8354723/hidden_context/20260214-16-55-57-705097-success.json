{
  "session_id": "9b125a7fa8354723",
  "admin_id": 1,
  "step_name": "hidden_context",
  "status": "success",
  "error_message": null,
  "timestamp": "2026-02-14T16:55:57",
  "input": {
    "rewritten_query": "查询信息工程学院2024级在2025年9月的迟到、缺勤和早退等异常考勤记录",
    "parse_result": {
      "intent": "business_query",
      "entities": [
        {
          "type": "college",
          "value": "信息工程学院"
        },
        {
          "type": "grade",
          "value": "2024级"
        },
        {
          "type": "time",
          "value": "2025年9月"
        },
        {
          "type": "attendance_status",
          "value": "['迟到', '缺勤', '早退']"
        }
      ],
      "dimensions": [
        "student.student_no",
        "student.real_name",
        "course_class.id",
        "attendance.attend_date",
        "attendance.status"
      ],
      "metrics": [],
      "filters": [
        {
          "field": "college.college_name",
          "op": "=",
          "value": "信息工程学院"
        },
        {
          "field": "class.grade_year",
          "op": "=",
          "value": 2024
        },
        {
          "field": "attendance.attend_date",
          "op": ">=",
          "value": "2025-09-01"
        },
        {
          "field": "attendance.attend_date",
          "op": "<=",
          "value": "2025-09-30"
        },
        {
          "field": "attendance.status",
          "op": "in",
          "value": [
            "迟到",
            "缺勤",
            "早退"
          ]
        }
      ],
      "time_range": {
        "start": "2025-09-01",
        "end": "2025-09-30"
      },
      "operation": "detail",
      "confidence": 0.95
    },
    "sql_result": {
      "sql": "WITH base AS (SELECT student.student_no, student.real_name, course_class.id AS course_class_id, attendance.attend_date, attendance.status FROM college JOIN major ON college.id = major.college_id JOIN class ON major.id = class.major_id JOIN student ON class.id = student.class_id JOIN enroll ON student.id = enroll.student_id JOIN course_class ON enroll.course_class_id = course_class.id JOIN attendance ON student.id = attendance.student_id AND course_class.id = attendance.course_class_id WHERE college.college_name = '信息工程学院' AND class.grade_year = 2024 AND attendance.attend_date >= '2025-09-01' AND attendance.attend_date <= '2025-09-30' AND attendance.status IN ('迟到', '缺勤', '早退') AND college.is_deleted = 0 AND major.is_deleted = 0 AND class.is_deleted = 0 AND student.is_deleted = 0 AND enroll.is_deleted = 0 AND course_class.is_deleted = 0 AND attendance.is_deleted = 0) SELECT base.student_no, base.real_name, base.course_class_id, base.attend_date, base.status FROM base",
      "entity_mappings": [
        {
          "type": "college",
          "value": "信息工程学院",
          "field": "college.college_name",
          "reason": "根据字段描述“学院名称，学院实体映射主字段”精确匹配"
        },
        {
          "type": "grade",
          "value": "2024级",
          "field": "class.grade_year",
          "reason": "根据字段描述“年级/入学年份（如 2022 级）”映射为整数 2024"
        },
        {
          "type": "time",
          "value": "2025年9月",
          "field": "attendance.attend_date",
          "reason": "转换为日期范围 2025-09-01 至 2025-09-30，符合字段描述“考勤日期”"
        },
        {
          "type": "attendance_status",
          "value": "['迟到', '缺勤', '早退']",
          "field": "attendance.status",
          "reason": "根据字段描述“出勤状态（出勤/缺勤/请假等）”直接使用原始值列表过滤"
        }
      ],
      "sql_fields": [
        "student.student_no",
        "student.real_name",
        "course_class.id",
        "attendance.attend_date",
        "attendance.status",
        "college.id",
        "major.college_id",
        "major.id",
        "class.major_id",
        "class.id",
        "student.class_id",
        "student.id",
        "enroll.student_id",
        "enroll.course_class_id",
        "attendance.student_id",
        "attendance.course_class_id",
        "college.college_name",
        "class.grade_year",
        "college.is_deleted",
        "major.is_deleted",
        "class.is_deleted",
        "student.is_deleted",
        "enroll.is_deleted",
        "course_class.is_deleted",
        "attendance.is_deleted",
        "base.student_no",
        "base.real_name",
        "base.course_class_id",
        "base.attend_date",
        "base.status"
      ],
      "applied_field_replacements": []
    },
    "sql_validate_result": {
      "is_valid": true,
      "error": null,
      "rows": 0,
      "result": [],
      "executed_sql": "WITH base AS (SELECT student.student_no, student.real_name, course_class.id AS course_class_id, attendance.attend_date, attendance.status FROM college JOIN major ON college.id = major.college_id JOIN class ON major.id = class.major_id JOIN student ON class.id = student.class_id JOIN enroll ON student.id = enroll.student_id JOIN course_class ON enroll.course_class_id = course_class.id JOIN attendance ON student.id = attendance.student_id AND course_class.id = attendance.course_class_id WHERE college.college_name = '信息工程学院' AND class.grade_year = 2024 AND attendance.attend_date >= '2025-09-01' AND attendance.attend_date <= '2025-09-30' AND attendance.status IN ('迟到', '缺勤', '早退') AND college.is_deleted = 0 AND major.is_deleted = 0 AND class.is_deleted = 0 AND student.is_deleted = 0 AND enroll.is_deleted = 0 AND course_class.is_deleted = 0 AND attendance.is_deleted = 0) SELECT base.student_no, base.real_name, base.course_class_id, base.attend_date, base.status FROM base",
      "empty_result": true,
      "zero_metric_result": false
    },
    "hidden_context_retry_count": 0
  },
  "output": {
    "retry_reason": "empty_result",
    "error_type": "execution_error",
    "error": "",
    "failed_sql": "WITH base AS (SELECT student.student_no, student.real_name, course_class.id AS course_class_id, attendance.attend_date, attendance.status FROM college JOIN major ON college.id = major.college_id JOIN class ON major.id = class.major_id JOIN student ON class.id = student.class_id JOIN enroll ON student.id = enroll.student_id JOIN course_class ON enroll.course_class_id = course_class.id JOIN attendance ON student.id = attendance.student_id AND course_class.id = attendance.course_class_id WHERE college.college_name = '信息工程学院' AND class.grade_year = 2024 AND attendance.attend_date >= '2025-09-01' AND attendance.attend_date <= '2025-09-30' AND attendance.status IN ('迟到', '缺勤', '早退') AND college.is_deleted = 0 AND major.is_deleted = 0 AND class.is_deleted = 0 AND student.is_deleted = 0 AND enroll.is_deleted = 0 AND course_class.is_deleted = 0 AND attendance.is_deleted = 0) SELECT base.student_no, base.real_name, base.course_class_id, base.attend_date, base.status FROM base",
    "rewritten_query": "查询信息工程学院2024级在2025年9月的迟到、缺勤和早退等异常考勤记录",
    "field_candidates": [],
    "probe_samples": [
      {
        "field": "student.student_no",
        "probe_sql": "SELECT DISTINCT student.student_no AS value FROM student WHERE student.student_no IS NOT NULL AND student.is_deleted = 0 LIMIT 20",
        "values": [
          "S00001",
          "S00002",
          "S00003",
          "S00004",
          "S00005",
          "S00006",
          "S00007",
          "S00008",
          "S00009",
          "S00010",
          "S00011",
          "S00012",
          "S00013",
          "S00014",
          "S00015",
          "S00016",
          "S00017",
          "S00018",
          "S00019",
          "S00020"
        ]
      },
      {
        "field": "student.real_name",
        "probe_sql": "SELECT DISTINCT student.real_name AS value FROM student WHERE student.real_name IS NOT NULL AND student.is_deleted = 0 LIMIT 20",
        "values": [
          "施伟",
          "Ethan",
          "周鹏",
          "孔航",
          "吴斌",
          "沈强博",
          "Isabella",
          "孙芳",
          "钱丹",
          "施斌",
          "周欣",
          "Olivia",
          "沈燕",
          "郑涛宇",
          "吕斌",
          "陶洋",
          "何勇",
          "姜萍",
          "冯峰",
          "郑航"
        ]
      },
      {
        "field": "course_class.id",
        "probe_sql": "SELECT DISTINCT course_class.id AS value FROM course_class WHERE course_class.id IS NOT NULL AND course_class.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20"
        ]
      },
      {
        "field": "attendance.attend_date",
        "probe_sql": "SELECT DISTINCT attendance.attend_date AS value FROM attendance WHERE attendance.attend_date IS NOT NULL AND attendance.is_deleted = 0 LIMIT 20",
        "values": [
          "2025-09-25",
          "2025-09-07",
          "2025-09-10",
          "2025-09-18",
          "2025-09-23",
          "2025-09-08",
          "2025-09-22",
          "2025-09-27",
          "2025-09-05",
          "2025-09-03",
          "2025-09-21",
          "2025-09-02",
          "2025-09-28",
          "2025-09-12",
          "2025-09-24",
          "2025-09-11",
          "2025-09-20",
          "2025-09-04",
          "2025-09-15",
          "2025-09-26"
        ]
      },
      {
        "field": "attendance.status",
        "probe_sql": "SELECT DISTINCT attendance.status AS value FROM attendance WHERE attendance.status IS NOT NULL AND attendance.is_deleted = 0 LIMIT 20",
        "values": [
          "缺勤",
          "迟到",
          "早退",
          "出勤"
        ]
      },
      {
        "field": "college.id",
        "probe_sql": "SELECT DISTINCT college.id AS value FROM college WHERE college.id IS NOT NULL AND college.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8"
        ]
      },
      {
        "field": "major.college_id",
        "probe_sql": "SELECT DISTINCT major.college_id AS value FROM major WHERE major.college_id IS NOT NULL AND major.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8"
        ]
      },
      {
        "field": "major.id",
        "probe_sql": "SELECT DISTINCT major.id AS value FROM major WHERE major.id IS NOT NULL AND major.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20"
        ]
      },
      {
        "field": "class.major_id",
        "probe_sql": "SELECT DISTINCT class.major_id AS value FROM class WHERE class.major_id IS NOT NULL AND class.is_deleted = 0",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20",
          "21",
          "22",
          "23",
          "24",
          "25",
          "26",
          "27",
          "28",
          "29",
          "30",
          "31",
          "32",
          "33",
          "34",
          "35",
          "36",
          "37",
          "38",
          "39",
          "40",
          "41",
          "42",
          "43",
          "44",
          "45",
          "46",
          "47",
          "48",
          "49",
          "50",
          "51",
          "52",
          "53",
          "54",
          "55",
          "56",
          "57",
          "58",
          "59",
          "60",
          "61",
          "62",
          "63",
          "64"
        ]
      },
      {
        "field": "class.id",
        "probe_sql": "SELECT DISTINCT class.id AS value FROM class WHERE class.id IS NOT NULL AND class.is_deleted = 0",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20",
          "21",
          "22",
          "23",
          "24",
          "25",
          "26",
          "27",
          "28",
          "29",
          "30",
          "31",
          "32",
          "33",
          "34",
          "35",
          "36",
          "37",
          "38",
          "39",
          "40",
          "41",
          "42",
          "43",
          "44",
          "45",
          "46",
          "47",
          "48",
          "49",
          "50",
          "51",
          "52",
          "53",
          "54",
          "55",
          "56",
          "57",
          "58",
          "59",
          "60",
          "61",
          "62",
          "63",
          "64",
          "65",
          "66",
          "67",
          "68",
          "69",
          "70",
          "71",
          "72",
          "73",
          "74",
          "75",
          "76",
          "77",
          "78",
          "79",
          "80",
          "81",
          "82",
          "83",
          "84",
          "85",
          "86",
          "87",
          "88",
          "89",
          "90",
          "91",
          "92",
          "93",
          "94",
          "95",
          "96",
          "97",
          "98",
          "99",
          "100",
          "101",
          "102",
          "103",
          "104",
          "105",
          "106",
          "107",
          "108",
          "109",
          "110",
          "111",
          "112",
          "113",
          "114",
          "115",
          "116",
          "117",
          "118",
          "119",
          "120",
          "121",
          "122",
          "123",
          "124",
          "125",
          "126",
          "127",
          "128",
          "129",
          "130",
          "131",
          "132",
          "133",
          "134",
          "135",
          "136",
          "137",
          "138",
          "139",
          "140",
          "141",
          "142",
          "143",
          "144",
          "145",
          "146",
          "147",
          "148",
          "149",
          "150",
          "151",
          "152",
          "153",
          "154",
          "155",
          "156",
          "157",
          "158",
          "159",
          "160",
          "161",
          "162",
          "163",
          "164",
          "165",
          "166",
          "167",
          "168",
          "169",
          "170",
          "171",
          "172",
          "173",
          "174",
          "175",
          "176",
          "177",
          "178",
          "179",
          "180",
          "181",
          "182",
          "183",
          "184",
          "185",
          "186",
          "187",
          "188",
          "189",
          "190",
          "191",
          "192",
          "193",
          "194",
          "195",
          "196",
          "197",
          "198",
          "199",
          "200",
          "201",
          "202",
          "203",
          "204",
          "205",
          "206",
          "207",
          "208",
          "209",
          "210",
          "211",
          "212",
          "213",
          "214",
          "215",
          "216",
          "217",
          "218",
          "219",
          "220",
          "221",
          "222",
          "223",
          "224",
          "225",
          "226",
          "227",
          "228",
          "229",
          "230",
          "231",
          "232",
          "233",
          "234",
          "235",
          "236",
          "237",
          "238",
          "239",
          "240",
          "241",
          "242",
          "243",
          "244",
          "245",
          "246",
          "247",
          "248",
          "249",
          "250",
          "251",
          "252",
          "253",
          "254",
          "255",
          "256",
          "257",
          "258",
          "259",
          "260",
          "261",
          "262",
          "263",
          "264",
          "265",
          "266",
          "267",
          "268",
          "269",
          "270",
          "271",
          "272",
          "273",
          "274",
          "275",
          "276",
          "277",
          "278",
          "279",
          "280",
          "281",
          "282",
          "283",
          "284",
          "285",
          "286",
          "287",
          "288",
          "289",
          "290",
          "291",
          "292",
          "293",
          "294",
          "295",
          "296",
          "297",
          "298",
          "299",
          "300",
          "301",
          "302",
          "303",
          "304",
          "305",
          "306",
          "307",
          "308",
          "309",
          "310",
          "311",
          "312",
          "313",
          "314",
          "315",
          "316",
          "317",
          "318",
          "319",
          "320",
          "321",
          "322",
          "323",
          "324",
          "325",
          "326",
          "327",
          "328",
          "329",
          "330",
          "331",
          "332",
          "333",
          "334",
          "335",
          "336",
          "337",
          "338",
          "339",
          "340",
          "341",
          "342",
          "343",
          "344",
          "345",
          "346",
          "347",
          "348",
          "349",
          "350",
          "351",
          "352",
          "353",
          "354",
          "355",
          "356",
          "357",
          "358",
          "359",
          "360",
          "361",
          "362",
          "363",
          "364",
          "365",
          "366",
          "367",
          "368",
          "369",
          "370",
          "371",
          "372",
          "373",
          "374",
          "375",
          "376",
          "377",
          "378",
          "379",
          "380",
          "381",
          "382",
          "383",
          "384"
        ]
      },
      {
        "field": "student.class_id",
        "probe_sql": "SELECT DISTINCT student.class_id AS value FROM student WHERE student.class_id IS NOT NULL AND student.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20"
        ]
      },
      {
        "field": "student.id",
        "probe_sql": "SELECT DISTINCT student.id AS value FROM student WHERE student.id IS NOT NULL AND student.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20"
        ]
      },
      {
        "field": "enroll.student_id",
        "probe_sql": "SELECT DISTINCT enroll.student_id AS value FROM enroll WHERE enroll.student_id IS NOT NULL AND enroll.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20"
        ]
      },
      {
        "field": "enroll.course_class_id",
        "probe_sql": "SELECT DISTINCT enroll.course_class_id AS value FROM enroll WHERE enroll.course_class_id IS NOT NULL AND enroll.is_deleted = 0 LIMIT 20",
        "values": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11",
          "12",
          "13",
          "14",
          "15",
          "16",
          "17",
          "18",
          "19",
          "20"
        ]
      },
      {
        "field": "attendance.student_id",
        "probe_sql": "SELECT DISTINCT attendance.student_id AS value FROM attendance WHERE attendance.student_id IS NOT NULL AND attendance.is_deleted = 0 LIMIT 20",
        "values": [
          "8619",
          "11730",
          "5257",
          "16266",
          "15752",
          "91",
          "2918",
          "18815",
          "2953",
          "3321",
          "7576",
          "8656",
          "3272",
          "1294",
          "10248",
          "3799",
          "1505",
          "4536",
          "11717",
          "8793"
        ]
      },
      {
        "field": "attendance.course_class_id",
        "probe_sql": "SELECT DISTINCT attendance.course_class_id AS value FROM attendance WHERE attendance.course_class_id IS NOT NULL AND attendance.is_deleted = 0 LIMIT 20",
        "values": [
          "2143",
          "1679",
          "162",
          "851",
          "1355",
          "53",
          "453",
          "2024",
          "2096",
          "1049",
          "1871",
          "1902",
          "716",
          "1191",
          "1745",
          "390",
          "40",
          "699",
          "1793",
          "381"
        ]
      },
      {
        "field": "college.college_name",
        "probe_sql": "SELECT DISTINCT college.college_name AS value FROM college WHERE college.college_name IS NOT NULL AND college.is_deleted = 0 LIMIT 20",
        "values": [
          "三峡科技MOCK大学信息工程学院",
          "三峡科技MOCK大学智能制造学院",
          "三峡科技MOCK大学管理学院",
          "三峡科技MOCK大学人文学院",
          "三峡科技MOCK大学经济与贸易学院",
          "三峡科技MOCK大学外国语学院",
          "三峡科技MOCK大学理学院",
          "三峡科技MOCK大学艺术与设计学院"
        ]
      },
      {
        "field": "class.grade_year",
        "probe_sql": "SELECT DISTINCT class.grade_year AS value FROM class WHERE class.grade_year IS NOT NULL AND class.is_deleted = 0",
        "values": [
          "2022",
          "2024",
          "2023",
          "2025"
        ]
      },
      {
        "field": "college.is_deleted",
        "probe_sql": "SELECT DISTINCT college.is_deleted AS value FROM college WHERE college.is_deleted IS NOT NULL AND college.is_deleted = 0 LIMIT 20",
        "values": [
          "0"
        ]
      },
      {
        "field": "major.is_deleted",
        "probe_sql": "SELECT DISTINCT major.is_deleted AS value FROM major WHERE major.is_deleted IS NOT NULL AND major.is_deleted = 0 LIMIT 20",
        "values": [
          "0"
        ]
      },
      {
        "field": "class.is_deleted",
        "probe_sql": "SELECT DISTINCT class.is_deleted AS value FROM class WHERE class.is_deleted IS NOT NULL AND class.is_deleted = 0",
        "values": [
          "0"
        ]
      },
      {
        "field": "student.is_deleted",
        "probe_sql": "SELECT DISTINCT student.is_deleted AS value FROM student WHERE student.is_deleted IS NOT NULL AND student.is_deleted = 0 LIMIT 20",
        "values": [
          "0"
        ]
      },
      {
        "field": "enroll.is_deleted",
        "probe_sql": "SELECT DISTINCT enroll.is_deleted AS value FROM enroll WHERE enroll.is_deleted IS NOT NULL AND enroll.is_deleted = 0 LIMIT 20",
        "values": [
          "0"
        ]
      },
      {
        "field": "course_class.is_deleted",
        "probe_sql": "SELECT DISTINCT course_class.is_deleted AS value FROM course_class WHERE course_class.is_deleted IS NOT NULL AND course_class.is_deleted = 0 LIMIT 20",
        "values": [
          "0"
        ]
      }
    ],
    "value_candidates": [
      {
        "field": "college.college_name",
        "original_value": "信息工程学院",
        "candidates": [
          "三峡科技MOCK大学信息工程学院"
        ],
        "match_strategy": "fuzzy"
      },
      {
        "field": "class.grade_year",
        "original_value": "2024",
        "candidates": [
          "2024"
        ],
        "match_strategy": "exact"
      },
      {
        "field": "attendance.attend_date",
        "original_value": "2025-09-01",
        "candidates": [
          "2025-09-25",
          "2025-09-07",
          "2025-09-10",
          "2025-09-18",
          "2025-09-23"
        ],
        "match_strategy": "fallback_probe_topn"
      },
      {
        "field": "attendance.attend_date",
        "original_value": "2025-09-30",
        "candidates": [
          "2025-09-25",
          "2025-09-07",
          "2025-09-10",
          "2025-09-18",
          "2025-09-23"
        ],
        "match_strategy": "fallback_probe_topn"
      },
      {
        "field": "attendance.status",
        "original_value": "['迟到', '缺勤', '早退']",
        "candidates": [
          "缺勤",
          "迟到",
          "早退"
        ],
        "match_strategy": "fuzzy"
      }
    ],
    "hints": [
      "error_type=execution_error",
      "use_probe_samples_to_rewrite_filters_or_entities",
      "prioritize_value_candidates_for_empty_result",
      "retry_sql_generation_with_hidden_context"
    ],
    "kb_summary": {
      "table_count": 10,
      "field_count": 84
    },
    "retry_count": 1
  }
}